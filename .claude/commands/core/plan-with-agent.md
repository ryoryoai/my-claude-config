---
description: 実装計画の作成（アイデア→Plans.md→/workで開始）
description-en: Create implementation plan (idea → Plans.md → ready for /work)
---

# /plan-with-agent - 実装計画の作成

アイデアや要望を整理し、Plans.md に実行可能なタスクとして落とし込みます。
完了後は `/work` ですぐに作業を開始できます。

## こう言えばOK

- 「**計画を作って**」→ このコマンド
- 「**今話してた内容を計画にして**」→ 会話から要件を抽出して計画化
- 「**何を作るか整理したい**」→ ヒアリングから始めて計画化
- 「**機能を洗い出して**」→ 機能リスト→優先度→Plans.md

## できること（成果物）

- **Plans.md** - `/work` で実行可能なタスク一覧（必須）
- **機能優先度マトリクス** - 必須/推奨/オプションの分類
- **提案書**（オプション）- 受託開発の場合のみ

---

## ⚠️ モード別の使い分け

| モード | 推奨コマンド | 説明 |
|--------|-------------|------|
| **ソロモード** | `/plan-with-agent` (このコマンド) | Claude Code だけで計画→実行→レビュー |
| **2エージェントモード** | `/plan-with-cc` (Cursor側) | Cursor で計画 → Claude Code で実行 |

---

## 使用するスキル

このコマンドは以下のスキルを活用します：

- `adaptive-setup` - プロジェクト構造の初期化
- `vibecoder-guide` - VibeCoder向けガイダンス
- `core-read-repo-context` - プロジェクト状態の把握

---

## 実行フロー

### Step 0: 会話コンテキストの確認（最初に必ず実行）

**AskUserQuestion ツールで確認**:

> 📝 **計画の作り方を選んでください**
>
> 1. **今までの会話を踏まえる** - 壁打ちで話した内容から計画を作成
> 2. **新しく始める** - ゼロからヒアリングして計画を作成

**「今までの会話を踏まえる」が選択された場合**:
- 直近の会話から要件・アイデア・決定事項を抽出
- 抽出した内容をユーザーに確認
- 確認後、Step 3（技術調査）へスキップ

**「新しく始める」が選択された場合**:
- Step 1 からヒアリングを開始

---

### Step 1: やりたいことのヒアリング

ユーザーの入力を確認。入力がない場合は質問：

> 🎯 **何を作りたいですか？**
>
> 例：
> - 「予約管理システム」
> - 「ブログサイト」
> - 「タスク管理アプリ」
> - 「API サーバー」
>
> ざっくりで大丈夫です！

**回答を待つ**

### Step 2: 解像度を上げる（最大3問）

> 📋 **もう少し教えてください：**
>
> 1. **誰が使いますか？**（自分だけ？チーム？一般公開？）
> 2. **似ているサービスはありますか？**（参考になるもの）
> 3. **どこまで作りたいですか？**（MVP？フル機能？）

**回答を待つ**

### Step 3: 技術調査（WebSearch）

**ユーザーには聞かない。Claude Code が調査して提案。**

```
WebSearch で調査:
- "{{プロジェクトタイプ}} tech stack 2025"
- "{{類似サービス}} architecture"
```

### Step 4: 機能リストの抽出

要望から、具体的な機能リストを抽出します。

**例**: 「予約管理システム」の場合
- ユーザー登録・ログイン
- 予約カレンダー表示
- 予約の作成・編集・キャンセル
- 管理者ダッシュボード
- メール通知
- 決済機能
- レビュー機能

### Step 5: 機能優先度マトリクスの作成

各機能を以下の3つに分類します：

| 優先度 | 説明 | 基準 |
|--------|------|------|
| **必須** | MVP（最小限の製品）に必要 | これがないと動かない |
| **推奨** | ユーザー体験を大幅に向上 | あると嬉しいが、なくても動く |
| **オプション** | 将来的に追加検討 | 時間に余裕があれば |

**例**: 予約管理システムの場合

| 機能 | 優先度 | 理由 |
|------|--------|------|
| ユーザー登録・ログイン | 必須 | 予約には認証が必要 |
| 予約カレンダー表示 | 必須 | コア機能 |
| 予約の作成・編集・キャンセル | 必須 | コア機能 |
| 管理者ダッシュボード | 推奨 | 運用効率が向上 |
| メール通知 | 推奨 | ユーザー体験が向上 |
| 決済機能 | オプション | 後から追加可能 |
| レビュー機能 | オプション | 後から追加可能 |

### Step 6: 工数の見積もり（参考）

各機能の実装工数を参考として算出します。

**見積もり基準**（Claude Code 活用時）:

| 機能タイプ | 工数（人日） |
|-----------|------------|
| 認証（Clerk使用） | 0.5-1 |
| CRUD（1テーブル） | 1-2 |
| 管理画面（基本） | 2-3 |
| 決済（Stripe使用） | 2-3 |
| メール通知 | 1-2 |
| CI/CD構築 | 1 |
| デプロイ設定 | 0.5 |

### Step 7: Plans.md の生成（品質判定マーカー自動付与）

実装用の `Plans.md` を生成します。

**品質判定マーカーの自動付与**:

各タスクの内容を分析し、適切な品質マーカーを自動で付与：

| タスク内容 | マーカー | 効果 |
|-----------|---------|------|
| 認証/ログイン機能 | `[feature:security]` | セキュリティチェックリスト表示 |
| UI コンポーネント | `[feature:a11y]` | a11y チェック推奨 |
| ビジネスロジック | `[feature:tdd]` | TDD 推奨 |
| API エンドポイント | `[feature:security]` | 入力検証チェック |
| バグ修正 | `[bugfix:reproduce-first]` | 再現テスト先行推奨 |

```markdown
## 🎯 プロジェクト: {{プロジェクト名}}

### 概要
- **目的**: {{やりたいこと}}
- **対象**: {{誰が使うか}}
- **参考**: {{類似サービス}}
- **スコープ**: {{MVPか全機能か}}

### 技術スタック
- フロントエンド: {{技術}}
- バックエンド: {{技術}}
- データベース: {{技術}}
- デプロイ: {{技術}}

---

## 🔴 フェーズ1: 基盤構築 `cc:TODO`

- [ ] プロジェクト初期化
- [ ] 基本セットアップ（linter, formatter）
- [ ] データベース設計
- [ ] 環境変数の設定
- [ ] Git初期化 & 初回コミット

## 🟡 フェーズ2: コア機能（必須） `cc:TODO`

- [ ] {{必須機能1}} `[feature:tdd]`
- [ ] {{必須機能2}} `[feature:tdd]`
- [ ] {{認証機能}} `[feature:security]`

## 🟢 フェーズ3: 推奨機能 `cc:TODO`

- [ ] {{UI機能}} `[feature:a11y]`
- [ ] {{推奨機能}}

## 🔵 フェーズ4: 仕上げ `cc:TODO`

- [ ] レビュー（`/harness-review`）
- [ ] デプロイ設定
- [ ] 動作確認
```

**マーカー判定ロジック**:

```
タスク内容を分析
    ↓
├── "認証" "ログイン" "auth" "API" → [feature:security]
├── "コンポーネント" "UI" "画面" → [feature:a11y]
├── "修正" "バグ" "fix" → [bugfix:reproduce-first]
├── "サービス" "ロジック" "core" → [feature:tdd]
└── その他 → マーカーなし
```

### Step 8: 次のアクションを案内

> ✅ **計画が完成しました！**
>
> 📄 **生成したファイル**:
> - `Plans.md` - 実装タスク一覧
>
> **次にやること：**
> - 「`/work`」で実装を開始
> - 「フェーズ1から始めて」と言ってもOK
>
> 💡 **ヒント**: 計画を調整したい場合は「{{機能名}}を追加して」「{{機能名}}は後回しにして」と言ってください。

---

## 受託開発オプション

受託開発で提案書が必要な場合は、「**提案書も作って**」と追加で指示してください。

以下が追加で生成されます：
- `docs/proposal.md` - 見積もり・スケジュール含む提案書
- `docs/priority_matrix.md` - 機能優先度マトリクス

### 提案書テンプレート

```markdown
# 提案書: {{プロジェクト名}}

**作成日**: {{日付}}

---

## 1. プロジェクト概要

### 目的
{{要望を整理}}

### 対象ユーザー
{{エンドユーザーの属性}}

---

## 2. 提案する機能

### 必須機能（MVP）

| 機能 | 説明 | 工数（人日） |
|------|------|------------|
| {{機能1}} | {{説明}} | {{工数}} |

### 推奨機能

| 機能 | 説明 | 工数（人日） |
|------|------|------------|
| {{機能2}} | {{説明}} | {{工数}} |

---

## 3. 見積もり

- **工数**: {{合計工数}}人日
- **金額**: {{概算金額}}円（1人日 = {{単価}}円）

---

## 4. スケジュール

| フェーズ | 内容 |
|---------|------|
| フェーズ1 | 基盤構築 |
| フェーズ2 | コア機能 |
| フェーズ3 | 仕上げ |
```

---

## 出力例

### 例1: 壁打ちからの計画化

```
ユーザー: （壁打ちで「タスク管理アプリ作りたい、Notionみたいな」と話していた）
ユーザー: /plan-with-agent

Claude Code:
> 📝 計画の作り方を選んでください
> 1. 今までの会話を踏まえる
> 2. 新しく始める

ユーザー: 1

Claude Code:
> 会話から以下を抽出しました：
> - 作りたいもの: タスク管理アプリ
> - 参考: Notion
> - 機能候補: タスクCRUD, カンバン表示, タグ機能
>
> これで計画を進めてよいですか？

ユーザー: OK

→ Plans.md 生成
```

### 例2: 新規からの計画化

```
ユーザー: /plan-with-agent

Claude Code:
> 📝 計画の作り方を選んでください

ユーザー: 新しく始める

Claude Code:
> 🎯 何を作りたいですか？

ユーザー: ブログサイト

（ヒアリング継続）
→ Plans.md 生成
```

---

## 注意事項

- **Plans.md が最優先**: `/work` で実行できる状態にすることが目的
- **提案書はオプション**: 受託開発以外では不要
- **柔軟に調整可能**: 計画後も「〇〇を追加」「〇〇は削除」で変更可能
- **壁打ちの文脈を活用**: Step 0 で「会話を踏まえる」を選べば、議論した内容を反映
