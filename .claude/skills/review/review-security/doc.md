---
name: review-security
description: "コードのセキュリティ脆弱性をチェックするスキル。セキュリティレビューが要求された場合、本番デプロイ前、または機密情報を扱うコードの変更時に使用します。"
allowed-tools: ["Read", "Grep", "Glob", "Bash"]
metadata:
  skillport:
    category: worker
    tags: [security, review, vulnerability, owasp]
    alwaysApply: false
---

# Review Security

コードのセキュリティ脆弱性をチェックし、問題を報告するスキル。

---

## 目的

OWASP Top 10 を含む一般的なセキュリティ脆弱性を検出：
- インジェクション攻撃（SQL, コマンド, XSS）
- 認証・認可の問題
- 機密データの露出
- セキュリティの設定ミス

---

## 入力

| 項目 | 説明 |
|------|------|
| `files` | チェック対象ファイルのリスト |
| `code_content` | ファイルの内容 |

---

## 出力

| 項目 | 説明 |
|------|------|
| `security_issues` | 検出された問題のリスト |
| `security_score` | セキュリティスコア (A-F) |

---

## チェック項目

### 1. インジェクション

| チェック | 検出対象 |
|---------|----------|
| SQL インジェクション | 文字列連結でのクエリ構築 |
| コマンドインジェクション | 安全でないコマンド実行関数の使用 |
| XSS | 未サニタイズのHTML出力 |

### 2. 認証・認可

| チェック | 検出対象 |
|---------|----------|
| ハードコードされた認証情報 | パスワード、APIキーの直書き |
| 弱い認証 | 平文パスワード保存 |
| 認可チェック漏れ | 権限確認なしのリソースアクセス |

### 3. 機密データ

| チェック | 検出対象 |
|---------|----------|
| 機密情報のログ出力 | パスワード、トークンのログ |
| 安全でない通信 | HTTP での機密データ送信 |
| .env ファイルのコミット | git に含まれる機密ファイル |

### 4. 設定ミス

| チェック | 検出対象 |
|---------|----------|
| デバッグモード有効 | 本番での DEBUG=true |
| CORS 設定ミス | 過度に寛容なオリジン設定 |
| セキュリティヘッダー欠如 | CSP, X-Frame-Options の未設定 |

---

## スコアリング

| スコア | 基準 |
|--------|------|
| A | 問題なし |
| B | 軽微な問題 1-2 件 |
| C | 中程度の問題あり |
| D | 重大な問題あり |
| F | クリティカルな脆弱性あり |

---

## 出力例

```markdown
## セキュリティレビュー結果

**スコア**: B

### 検出された問題

| 重大度 | ファイル | 行 | 問題 |
|--------|---------|-----|------|
| 中 | src/api/users.ts | 45 | SQL インジェクションの可能性 |
| 低 | src/config.ts | 12 | ハードコードされた API URL |

### 推奨対策

1. **SQL インジェクション対策**
   - プレースホルダーを使用したクエリに変更
   - ORM のパラメータバインディングを活用

2. **設定の外部化**
   - API URL を環境変数に移動
```

---

## 注意事項

- false positive を減らすためコンテキストを考慮する
- セキュリティ問題は優先度高で報告する
- 修正方法も合わせて提示する
