---
name: review-quality
description: "コード品質（可読性、保守性、ベストプラクティス）をチェックするスキル。コードレビューが要求された場合、リファクタリング後、または複雑なロジックの実装後に使用します。"
allowed-tools: ["Read", "Grep", "Glob", "Bash"]
metadata:
  skillport:
    category: worker
    tags: [quality, review, clean-code, maintainability]
    alwaysApply: false
---

# Review Quality

コードの品質（可読性、保守性、ベストプラクティス）をチェックするスキル。

---

## 目的

以下の観点でコード品質を評価：
- 可読性（命名、構造、コメント）
- 保守性（モジュール性、依存関係）
- ベストプラクティス準拠
- コーディング規約準拠

---

## 入力

| 項目 | 説明 |
|------|------|
| `files` | チェック対象ファイルのリスト |
| `code_content` | ファイルの内容 |
| `eslint_output` | ESLint/Linter の出力（あれば） |

---

## 出力

| 項目 | 説明 |
|------|------|
| `quality_issues` | 検出された問題のリスト |
| `quality_score` | 品質スコア (A-F) |

---

## チェック項目

### 1. 可読性

| チェック | 問題 | 改善 |
|---------|------|------|
| 命名 | `x`, `tmp`, `data` などの曖昧な名前 | 意味のある名前に変更 |
| 関数の長さ | 50行以上の関数 | 小さな関数に分割 |
| ネスト深度 | 4段階以上のネスト | 早期リターン、関数抽出 |
| マジックナンバー | 直書きの数値 | 定数化 |

### 2. 保守性

| チェック | 問題 | 改善 |
|---------|------|------|
| 重複コード | 同じロジックの繰り返し | 共通関数に抽出 |
| 密結合 | 直接的な依存関係 | 依存性注入、インターフェース |
| グローバル状態 | グローバル変数の多用 | スコープの限定 |
| 未使用コード | 使われていない変数・関数 | 削除 |

### 3. ベストプラクティス

| チェック | 問題 | 改善 |
|---------|------|------|
| エラーハンドリング | 空の catch ブロック | 適切なエラー処理 |
| 型安全性 | any 型の多用 | 適切な型定義 |
| 非同期処理 | コールバック地獄 | async/await |
| テスタビリティ | テストしにくい構造 | 依存性注入 |

---

## スコアリング

| スコア | 基準 |
|--------|------|
| A | クリーンコード、問題なし |
| B | 軽微な改善余地 |
| C | 中程度の問題あり |
| D | 可読性・保守性に問題 |
| F | 深刻な品質問題 |

---

## 出力例

```markdown
## コード品質レビュー結果

**スコア**: B

### 検出された問題

| 重大度 | ファイル | 行 | 問題 |
|--------|---------|-----|------|
| 中 | src/services/user.ts | 45 | 関数が長すぎる (78行) |
| 低 | src/utils/helpers.ts | 12 | 未使用の import |
| 低 | src/api/posts.ts | 89 | マジックナンバー使用 |

### 推奨改善

1. **長い関数の分割**
   - `processUserData` 関数を以下に分割:
     - `validateUserInput()`
     - `formatUserData()`
     - `saveUser()`

2. **未使用コードの削除**
   - `import { unused } from './utils'` を削除

3. **定数化**
   ```typescript
   // Before
   if (retryCount > 3) { ... }

   // After
   const MAX_RETRY_COUNT = 3;
   if (retryCount > MAX_RETRY_COUNT) { ... }
   ```
```

---

## 注意事項

- プロジェクトの既存スタイルを尊重する
- 過度な改善提案は避ける
- 優先度を付けて報告する
