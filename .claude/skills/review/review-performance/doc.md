---
name: review-performance
description: "コードのパフォーマンス問題をチェックするスキル。パフォーマンスレビューが要求された場合、レスポンスが遅いと報告された場合、または大量のデータ処理を行うコードの変更時に使用します。"
allowed-tools: ["Read", "Grep", "Glob", "Bash"]
metadata:
  skillport:
    category: worker
    tags: [performance, review, optimization, speed]
    alwaysApply: false
---

# Review Performance

コードのパフォーマンス問題を検出し、改善提案を行うスキル。

---

## 目的

以下のパフォーマンス問題を検出：
- 非効率なアルゴリズム
- 不要な再レンダリング
- N+1 クエリ問題
- メモリリーク
- 重い処理のブロッキング

---

## 入力

| 項目 | 説明 |
|------|------|
| `files` | チェック対象ファイルのリスト |
| `code_content` | ファイルの内容 |

---

## 出力

| 項目 | 説明 |
|------|------|
| `performance_issues` | 検出された問題のリスト |
| `performance_score` | パフォーマンススコア (A-F) |

---

## チェック項目

### 1. フロントエンド（React/Vue）

| チェック | 問題 | 対策 |
|---------|------|------|
| 不要な再レンダリング | `useCallback`, `useMemo` 未使用 | メモ化の追加 |
| 大きなリストの非仮想化 | 1000+ アイテムの直接レンダリング | 仮想スクロール導入 |
| 重い計算の同期実行 | レンダリングブロック | Web Worker 使用 |
| バンドルサイズ | 大きな依存関係のインポート | 動的インポート |

### 2. バックエンド（API）

| チェック | 問題 | 対策 |
|---------|------|------|
| N+1 クエリ | ループ内でのDBクエリ | Eager loading |
| インデックス未使用 | 大量データのフルスキャン | インデックス追加 |
| 同期I/O | ファイル操作のブロッキング | async/await 使用 |
| キャッシュ未使用 | 頻繁な同一クエリ | Redis キャッシュ |

### 3. 一般

| チェック | 問題 | 対策 |
|---------|------|------|
| O(n²) アルゴリズム | ネストしたループ | より効率的なアルゴリズム |
| 文字列連結 | ループ内での `+=` | 配列 + join |
| 正規表現の非効率 | 毎回のコンパイル | 事前コンパイル |

---

## スコアリング

| スコア | 基準 |
|--------|------|
| A | 問題なし、最適化済み |
| B | 軽微な改善余地あり |
| C | 中程度の問題あり |
| D | 明らかなボトルネックあり |
| F | 深刻なパフォーマンス問題 |

---

## 出力例

```markdown
## パフォーマンスレビュー結果

**スコア**: C

### 検出された問題

| 重大度 | ファイル | 行 | 問題 |
|--------|---------|-----|------|
| 高 | src/api/posts.ts | 23 | N+1 クエリ問題 |
| 中 | src/components/List.tsx | 45 | 1500件の非仮想化リスト |
| 低 | src/utils/search.ts | 12 | O(n²) の検索アルゴリズム |

### 推奨対策

1. **N+1 クエリ問題**
   ```typescript
   // Before
   for (const post of posts) {
     const author = await getAuthor(post.authorId);
   }

   // After
   const posts = await getPosts({ include: ['author'] });
   ```

2. **仮想スクロール導入**
   - react-window または react-virtualized を使用
```

---

## 注意事項

- 早期最適化は避け、実際のボトルネックを優先
- 測定可能な改善効果を示す
- トレードオフ（可読性 vs パフォーマンス）を考慮
